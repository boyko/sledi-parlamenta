## Какво прави
Скриптът извлича информаця за дейността на всеки народен представител от стенограмите налични в XLS формат на http://www.parliament.bg/bg/plenaryst .

Все още скрипта е **НЕТЕСТВАН**, но описанието долу е фактически това което ще остане и след като всичко бъде тествано.

За момента информацията е сведена до:

 - присъствие
 - избор за всяко гласуване

## Очакван резултат
Дейността на 1 народен представеител за всеки 1 работен ден е представена като `JSON` документ под формата:

```json
{
    "name": "Иван Иванов",
    "date": "21/05/2013",
    "votes": [
        {
            "topic": "Увеличение на бюджета",
            "val": "yes",
            "time": "21-05-2013 11:54"
        },
        {
            "topic": "Решение за избор на председател",
            "val": "yes",
            "time": "21-05-2013 09:21"
        }
    ],
    "registration": {
        "time": "21-05-2013 11:30",
        "val": "present"
    }
}
```

## Употреба
```bash
node run.js -url=http://www.parliament.bg/bg/plenaryst
```

което ще изведе поредица от `json` документи, с по един документ на 1 ред, тоест:

```json
{"name":"Иван Иванов","date":"21/05/2013","votes":[{"topic":"Budget increase","val":"yes","time":"21-05-2013 11:54"}, /*...*/],"registration":{/*...*/}}
 ```

Ето и _"help"_-а на скрипта за повече яснота:

```
Crawls parliament.bg and extracts MPs' voting infromation.
Usage: node ./run.js

Options:
  -u, --url   Url to act as a start page for the crawl          [required]
  -d, --date  Date as unix time. Start date for the crawl       [default: null]
  -t, --temp  Temporary directory to store the raw transcripts  [default: "/var/tmp"]
```

URL-то фактически определя кое (42ро, 41во...) народно събание ще се _"crawl"_-ва.

Може да се подаде и стартова дата, преди която стенограмите нямат да бъдат обработвани. Дататата трябва да е _"unix timestamp"_:

```bash
node run.js -url=http://www.parliament.bg/bg/plenaryst --date=1374418193
```

Чрез нея е планирано да може скрипта да се изпълнява всеки ден и да обработва само нови стенограми.

### Оформяне на изведената информация за запис
Записа на информацията зависи от желаната база данни. За всяка различна DB, документите ще се трансформират за да паснат на нейната структура.

Примерен _"декоратор"_ за SQL база данни има в `decorator/sql.js`. Дадения декоратор-скрипт се ползва като се пренасочи извежданата информация от `run.js` към него. Или иначе казано _"pipe"_:

```bash
node run.js | node decorator/sql.js
```

което ще превърне описания горе JSON документ в:

```json
{"destination":"mp_presence","data":{"registration":"absent","commenced_at":"21-05-2013 11:30"}}
{"destination":"mp_vote","data":{"vote":"yes","topic":"Увеличение на бюджета","time":"21-05-2013 11:54"}}
{"destination":"mp_vote","data":{"vote":"yes","topic":"Решение за избор на председател","time":"21-05-2013 09:21"}}
```

Което на свой ред са нови JSON документи, като всеки 1 документ съдържа:

 - 1 поредица от данни съответстващи на точно 1 ред в базата данни
 - име на таблицата, където ще бъде запазен реда